<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resource Map - Sarasota Community Resource Hub</title>
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
  <style>
    #mapContainer {
      height: 600px;
      width: 100%;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(255, 140, 0, 0.15);
      margin: 2rem 0;
      border: 1px solid rgba(255, 140, 0, 0.1);
    }
    
    .leaflet-container {
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>
  <!-- Header & Navigation -->
  <header>
    <div class="header-content">
      <a href="index.html" class="logo-section">
        <img src="assets/favicon.ico" alt="Sarasota">
        <span>Sarasota Hub</span>
      </a>
      <nav id="main-nav">
        <a href="index.html" class="nav-link" data-page="home">Home</a>
        <a href="resources.html" class="nav-link" data-page="resources">Resources</a>
        <a href="map.html" class="nav-link active" data-page="map">Map</a>
        <a href="calendar.html" class="nav-link" data-page="calendar">Calendar</a>
        <a href="submit.html" class="nav-link" data-page="submit">Submit</a>
        <a href="about.html" class="nav-link" data-page="about">About</a>
      </nav>
      <button id="hamburger" class="hamburger" onclick="toggleMobileMenu()">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <!-- MAP PAGE -->
  <main style="padding-top: 2rem;">
    <div class="container">
      <div style="animation: fadeInDown 0.6s ease; margin-bottom: 2rem;">
        <h1>Resource Map</h1>
        <p style="font-size: 1.1rem; color: var(--text-light);">Interactive map of community resources across Sarasota</p>
      </div>

      <!-- Search & Filter -->
      <div class="search-filter-section" style="margin-bottom: 2rem;">
        <div class="search-filter-content">
          <div class="search-box">
            <label for="mapSearch">Search Resources</label>
            <input type="text" id="mapSearch" placeholder="Search by name, category, or service...">
          </div>
          <div class="filter-box">
            <label for="mapCategory">Filter by Category</label>
            <select id="mapCategory">
              <option value="">All Categories</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Map Container -->
      <div id="mapContainer"></div>

      <!-- Legend -->
      <div style="background: white; padding: 1.5rem; border-radius: 0.5rem; margin-top: 2rem; box-shadow: 0 2px 8px rgba(255, 140, 0, 0.1);">
        <h3 style="margin-bottom: 1rem;">Categories</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
          <span>ğŸ“š Libraries</span>
          <span>âš•ï¸ Healthcare</span>
          <span>ğŸ  Shelters</span>
          <span>ğŸ’¼ Job Services</span>
          <span>ğŸŒ³ Parks</span>
          <span>ğŸšŒ Transit</span>
          <span>ğŸ½ï¸ Food Services</span>
          <span>ğŸ‘¶ Youth Services</span>
          <span>ğŸ‘´ Senior Services</span>
          <span>ğŸ¤ Community Services</span>
          <span>ğŸ“ Education</span>
          <span>âš–ï¸ Legal Services</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>About Sarasota Hub</h4>
          <p>A comprehensive directory of community resources in Sarasota, Florida.</p>
        </div>
        <div class="footer-section">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="resources.html">Resources</a></li>
            <li><a href="map.html">Map</a></li>
            <li><a href="submit.html">Submit</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Contact</h4>
          <p>Email: <a href="mailto:sarasotahub@gmail.com">sarasotahub@gmail.com</a></p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>Â© 2026 Sarasota Community Resource Hub</p>
      </div>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <script src="js/resources-data.js"></script>
  <script>
    let map = null;
    let markers = [];
    let filteredResources = [];

    function toggleMobileMenu() {
      const hamburger = document.getElementById('hamburger');
      const nav = document.getElementById('main-nav');
      if (hamburger) hamburger.classList.toggle('active');
      if (nav) nav.classList.toggle('active');
    }

    function getCategoryIcon(category) {
      const icons = {
        'Libraries': 'ğŸ“š', 'Healthcare': 'âš•ï¸', 'Shelters': 'ğŸ ', 'Job Services': 'ğŸ’¼',
        'Parks': 'ğŸŒ³', 'Transit': 'ğŸšŒ', 'Food Services': 'ğŸ½ï¸', 'Youth Services': 'ğŸ‘¶',
        'Senior Services': 'ğŸ‘´', 'Community Services': 'ğŸ¤', 'Education': 'ğŸ“',
        'Legal Services': 'âš–ï¸', 'Support Services': 'ğŸ’ª', 'Family Services': 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',
        'Beaches': 'ğŸ–ï¸', 'Places to Go': 'ğŸ—ºï¸', 'Things to Do': 'ğŸ‰'
      };
      return icons[category] || 'ğŸ“';
    }

    function initMap() {
      console.log('Initializing map with', resourcesDatabase.length, 'resources');
      
      // Remove loading message if exists
      const container = document.getElementById('mapContainer');
      if (container.innerHTML.includes('Loading')) {
        container.innerHTML = '';
      }

      if (!map) {
        // Create map
        map = L.map('mapContainer').setView([27.3365, -82.5297], 11);

        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors',
          maxZoom: 19
        }).addTo(map);

        console.log('Map created successfully');
      }

      // Update markers
      updateMapMarkers(resourcesDatabase);
    }

    function updateMapMarkers(resources) {
      console.log('Updating map markers for', resources.length, 'resources');
      
      if (!map) {
        console.error('Map not initialized');
        return;
      }

      // Clear existing markers
      markers.forEach(marker => {
        map.removeLayer(marker);
      });
      markers = [];

      // Add new markers
      resources.forEach(resource => {
        if (resource.lat && resource.lng) {
          try {
            const marker = L.marker([resource.lat, resource.lng], {
              title: resource.name
            }).bindPopup(`
              <div style="width: 250px;">
                <h4 style=\"margin: 0 0 0.5rem 0; color: #e91e63;\">${resource.name}</h4>
                <p style="margin: 0 0 0.5rem 0; font-size: 0.9rem; color: #666;">${resource.category}</p>
                ${resource.address ? `<div style="margin: 0.5rem 0;"><strong>ğŸ“</strong> ${resource.address}</div>` : ''}
                ${resource.phone ? `<div style="margin: 0.5rem 0;"><strong>ğŸ“</strong> <a href="tel:${resource.phone}">${resource.phone}</a></div>` : ''}
                ${resource.website ? `<div style="margin: 0.5rem 0;"><strong>ğŸŒ</strong> <a href="${resource.website.startsWith('http') ? resource.website : 'https://' + resource.website}" target="_blank" rel="noopener noreferrer">Website</a></div>` : ''}
                ${resource.hours ? `<div style="margin: 0.5rem 0;"><strong>ğŸ•</strong> ${resource.hours}</div>` : ''}
              </div>
            `).addTo(map);
            markers.push(marker);
          } catch (e) {
            console.warn('Error adding marker for', resource.name, e);
          }
        }
      });

      // Fit bounds if markers exist
      if (markers.length > 0) {
        try {
          const group = new L.featureGroup(markers);
          map.fitBounds(group.getBounds().pad(0.1), { maxZoom: 13 });
          console.log('Map bounds updated');
        } catch (e) {
          console.warn('Error fitting bounds', e);
        }
      }
    }

    function filterResources() {
      const searchTerm = document.getElementById('mapSearch').value.toLowerCase();
      const category = document.getElementById('mapCategory').value;

      filteredResources = resourcesDatabase.filter(resource => {
        const matchesSearch = !searchTerm || 
          resource.name.toLowerCase().includes(searchTerm) ||
          resource.description.toLowerCase().includes(searchTerm) ||
          resource.category.toLowerCase().includes(searchTerm);
        
        const matchesCategory = !category || resource.category === category;
        
        return matchesSearch && matchesCategory;
      });

      console.log('Filtered to', filteredResources.length, 'resources');
      updateMapMarkers(filteredResources);
    }

    // Initialize when DOM is ready and data is loaded
    function startInitialization() {
      if (!resourcesDatabase || resourcesDatabase.length === 0) {
        console.log('Data not loaded yet, retrying...');
        setTimeout(startInitialization, 100);
        return;
      }

      console.log('Data loaded, initializing...');
      filteredResources = [...resourcesDatabase];
      initMap();

      // Setup category dropdown
      const categorySelect = document.getElementById('mapCategory');
      const categories = [...new Set(resourcesDatabase.map(r => r.category))].sort();
      categorySelect.innerHTML = '<option value="">All Categories</option>' + 
        categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');

      // Setup event listeners
      document.getElementById('mapSearch').addEventListener('input', filterResources);
      document.getElementById('mapCategory').addEventListener('change', filterResources);
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, data available:', !!resourcesDatabase);
      setTimeout(startInitialization, 100);
    });
  </script>
</body>
</html>

